name: Deploy to Hostinger (full mirror)

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Add Hostinger to known_hosts
        run: |
          mkdir -p ~/.ssh
          ssh-keyscan -p 65002 109.106.254.43 >> ~/.ssh/known_hosts

      - name: Deploy via rsync over SSH
        uses: SamKirkland/web-deploy@v1
        with:
          # SSH connection
          target-server: 109.106.254.43
          remote-user: u642727376
          private-ssh-key: ${{ secrets.SSH_PRIVATE_KEY }}
          ssh-port: 65002

          # Paths
          source-path: .
          destination-path: /home/u642727376/domains/sports-warehouse.reubenfraser.com/public_html

          # rsync behaviour
          rsync-options: >-
            --archive
            --compress
            --human-readable
            --delete-after
            --exclude=.git*
            --exclude=.github/**
            --exclude=.env
            --exclude=db/**
            --exclude=logs/**
            --exclude=uploads/**
            --exclude=wp-content/uploads/**
            --exclude=_backup_*/**
            --exclude=tests/local-only/**
            --exclude=manifest.php
            --exclude=_image-system_manifest.csv
            --exclude=**/.DS_Store
            --exclude=**/Thumbs.db

      - name: Create probe file over SSH (optional sanity check)
        uses: appleboy/ssh-action@v1
        with:
          host: 109.106.254.43
          username: u642727376
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 65002
          script: |
            date > /home/u642727376/domains/sports-warehouse.reubenfraser.com/public_html/gha_probe.txt

