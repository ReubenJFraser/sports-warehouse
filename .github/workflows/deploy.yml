name: Deploy (SCP probe)
on:
  push:
    branches: [ main ]
jobs:
  scp-and-probe:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # Upload just index.php to confirm file transfer
      - name: Copy index.php via SCP
        uses: appleboy/scp-action@v1
        with:
          host: 109.106.254.43
          username: u642727376
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 65002
          source: "index.php"
          target: "/home/u642727376/domains/sports-warehouse.reubenfraser.com/public_html"

      # Create a simple marker file server-side to double-confirm SSH works
      - name: Create probe file over SSH
        uses: appleboy/ssh-action@v1
        with:
          host: 109.106.254.43
          username: u642727376
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 65002
          script: |
            date > /home/u642727376/domains/sports-warehouse.reubenfraser.com/public_html/gha_probe.txt
